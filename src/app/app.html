<main class="page">
  <section class="card">
    <div class="badge">üíò Valentine‚Äôs Day</div>

    <h1 class="title">
      Hey <span class="name">{{ girlfriendName() }}</span>
    </h1>

    <p class="subtitle">I have a very important question‚Ä¶ but first, a tiny quiz üòÑ</p>

    <!-- QUIZ / FINAL PANEL -->
    <div class="question">
      <div class="heart">‚ù§Ô∏è</div>

      <!-- Step: VIBE -->
      @if (activeStep() === 'vibe') {
        <ng-container>
          <h2>Pick our vibe tonight</h2>
          <p class="small">Pick one or more and I‚Äôll build the perfect plan.</p>

          <div class="options">
            @for (option of vibeOptions; track option.label) {
              <button
                class="chip"
                [class.active]="selectedVibes().includes(option.label)"
                (click)="selectVibe(option.label)"
              >
                {{ option.emoji }} {{ option.label }}
              </button>
            }
          </div>

          <div class="nav">
            <button class="btn yes" (click)="goNext()" [disabled]="selectedVibes().length === 0">
              Next ‚ûú
            </button>
          </div>
        </ng-container>
      }

      <!-- Step: LOCATION -->
      @if (activeStep() === 'location') {
        <ng-container>
          <h2>Choose location</h2>
          <p class="small">Choose where we should meet.</p>

          <div class="options">
            @for (option of locationOptions; track option.label) {
              <button
                class="chip"
                [class.active]="selectedLocation() === option.label"
                (click)="selectLocation(option.label)"
              >
                {{ option.emoji }} {{ option.label }}
              </button>
            }
          </div>

          <div class="nav">
            <button class="btn no" (click)="goBack()">‚Üê Back</button>
            <button class="btn yes" (click)="goNext()" [disabled]="!selectedLocation()">
              Next ‚ûú
            </button>
          </div>
        </ng-container>
      }

      <!-- Step: DESSERT -->
      @if (activeStep() === 'dessert') {
        <ng-container>
          <h2>Choose dessert</h2>
          <p class="small">Important decisions only.</p>

          <div class="options">
            @for (option of dessertOptions; track option.label) {
              <button
                class="chip"
                [class.active]="selectedDessert() === option.label"
                (click)="selectDessert(option.label)"
              >
                {{ option.emoji }} {{ option.label }}
              </button>
            }
          </div>

          <div class="nav">
            <button class="btn no" (click)="goBack()">‚Üê Back</button>
            <button class="btn yes" (click)="goNext()" [disabled]="!selectedDessert()">
              Next ‚ûú
            </button>
          </div>
        </ng-container>
      }
      <!-- Step: PROMISE -->
      @if (activeStep() === 'promise') {
        <ng-container>
          <h2>One tiny promise</h2>
          <p class="small">Pick as MANY as what you want and I‚Äôll make them happen. No pressure.</p>

          <div class="options">
            @for (option of promiseOptions; track option.label) {
              <button
                class="chip"
                [class.active]="selectedPromise().includes(option.label)"
                (click)="selectPromise(option.label)"
              >
                {{ option.emoji }} {{ option.label }}
              </button>
            }
          </div>

          <div class="nav">
            <button class="btn no" (click)="goBack()">‚Üê Back</button>
            <button class="btn yes" (click)="goNext()" [disabled]="selectedPromise().length === 0">
              Reveal question ‚ú®
            </button>
          </div>
        </ng-container>
      }
      <!-- Step: FINAL QUESTION -->
      @if (activeStep() === 'final') {
        <ng-container>
          <h1 class="title">
            <span class="name">Will you be my Valentine?</span>
          </h1>
          <p class="small">(No pressure. Only extremely cute consequences.)</p>

          @if (hasQuizSelections()) {
            <div class="summary">
              <div class="summary-title">Our perfect date recipe:</div>
              <div class="summary-row">
                ‚ú® Vibe: <strong>{{ selectedVibes().join(', ') }}</strong>
              </div>
              <div class="summary-row">
                üìç Location: <strong>{{ selectedLocation() }}</strong>
              </div>
              <div class="summary-row">
                üç∞ Dessert: <strong>{{ selectedDessert() }}</strong>
              </div>
              <div class="summary-row">
                üíù Promise:
                <strong>
                  {{ selectedPromise().join(', ') }}
                </strong>
              </div>
            </div>
          }
          <div class="actions final-actions">
            <button class="btn yes" (click)="onYesClick()">Yes üíñ</button>
            <button class="btn no" (click)="onNoClick()">No üôÉ</button>
            <button class="link" (click)="restartQuiz()">Restart quiz</button>
          </div>
        </ng-container>
      }
    </div>

    <!-- RESULT -->
    @if (answer() !== 'none') {
      <div class="result">
        @if (answer() === 'yes') {
          <ng-container>
            <h3>YAAAAAY!! üéâ</h3>
            <p>I officially claim you for a romantic date.</p>

            <div class="details">
              <div class="detail-row"><span>‚ú®</span> {{ selectedVibes().join(', ') }}</div>
              <div class="detail-row"><span>üç∞</span> {{ selectedDessert() }}</div>
              <div class="detail-row"><span>üìç</span> {{ selectedLocation() }}</div>
              <div class="detail-row">
                <span>üíù</span>
                @for (promise of selectedPromise(); track promise) {
                  <div>{{ promise }}</div>
                }
              </div>
              <div class="detail-row"><span>‚è∞</span> {{ time() }}</div>
            </div>
            <div class="actions">
              <button class="btn yes" (click)="addToCalendar()">üìÖ Add to calendar</button>
            </div>
          </ng-container>
        }

        @if (answer() === 'no') {
          <ng-container>
            <h3>Hmmm ü§î</h3>
            <p>Okay. I still think you‚Äôre cute though.</p>
          </ng-container>
        }
      </div>
    }
  </section>

  <!-- floating hearts -->
  @if (answer() === 'yes') {
    <div class="hearts">
      @for (item of heartItems(); let itemIndex = $index; track itemIndex) {
        <span
          class="float"
          [style.left.%]="heartLeft(itemIndex)"
          [style.animationDelay.ms]="heartDelay(itemIndex)"
        >
          üíñ
        </span>
      }
    </div>
  }
</main>
